{
  "wkg_connection_manager": {
    "description": "Automates the entire WKG update process for a map transition. It checks for existing nodes, creates them if they don't exist, and then creates the edge connecting them. It handles both warp and map_edge connection types.",
    "input_schema": {
      "type": "object",
      "properties": {
        "source_map_name": {
          "type": "string"
        },
        "source_x": {
          "type": "integer"
        },
        "source_y": {
          "type": "integer"
        },
        "source_node_name": {
          "type": "string"
        },
        "destination_map_name": {
          "type": "string"
        },
        "destination_x": {
          "type": "integer"
        },
        "destination_y": {
          "type": "integer"
        },
        "destination_node_name": {
          "type": "string"
        },
        "connection_type": {
          "type": "string",
          "enum": [
            "warp",
            "map_edge"
          ]
        },
        "is_one_way": {
          "type": "boolean"
        }
      },
      "required": [
        "source_map_name",
        "source_x",
        "source_y",
        "source_node_name",
        "destination_map_name",
        "destination_x",
        "destination_y",
        "destination_node_name",
        "connection_type",
        "is_one_way"
      ]
    },
    "python_script": "import json\n\nMAP_NAME_TO_ID = {\n    \"PALLET_TOWN\": 0, \"VIRIDIAN_CITY\": 1, \"PEWTER_CITY\": 2, \"CERULEAN_CITY\": 3, \n    \"LAVENDER_TOWN\": 4, \"VERMILION_CITY\": 5, \"CELADON_CITY\": 6, \"FUCHSIA_CITY\": 7, \n    \"CINNABAR_ISLAND\": 8, \"INDIGO_PLATEAU\": 9, \"SAFFRON_CITY\": 10, \"ROUTE_1\": 12, \n    \"ROUTE_2\": 13, \"ROUTE_3\": 14, \"ROUTE_4\": 15, \"ROUTE_5\": 16, \"ROUTE_6\": 17, \n    \"ROUTE_7\": 18, \"ROUTE_8\": 19, \"ROUTE_9\": 20, \"ROUTE_10\": 21, \"ROUTE_11\": 22, \n    \"ROUTE_12\": 23, \"ROUTE_13\": 24, \"ROUTE_14\": 25, \"ROUTE_15\": 26, \"ROUTE_16\": 27, \n    \"ROUTE_17\": 28, \"ROUTE_18\": 29, \"ROUTE_19\": 30, \"ROUTE_20\": 31, \"ROUTE_21\": 32, \n    \"ROUTE_22\": 33, \"ROUTE_23\": 34, \"ROUTE_24\": 35, \"ROUTE_25\": 36,\n    \"PLAYERS_HOUSE_1F\": 37, \"PLAYERS_HOUSE_2F\": 38, \"RIVALS_HOUSE\": 39, \"OAKS_LAB\": 40,\n    \"VIRIDIAN_POKECENTER\": 41, \"VIRIDIAN_MART\": 42, \"VIRIDIAN_SCHOOL_HOUSE\": 43, \n    \"VIRIDIAN_NICKNAME_HOUSE\": 44, \"VIRIDIAN_GYM\": 45, \"DIGLETTS_CAVE_R2_HOUSE\": 46,\n    \"VIRIDIAN_FOREST_NORTH_GATE\": 47, \"ROUTE_2_TRADE_HOUSE\": 48, \"ROUTE_2_GATE\": 49,\n    \"VIRIDIAN_FOREST_SOUTH_GATE\": 50, \"VIRIDIAN_FOREST\": 51, \"PEWTER_MUSEUM_1F\": 52,\n    \"PEWTER_MUSEUM_2F\": 53, \"PEWTER_GYM\": 54, \"PEWTER_NIDORAN_HOUSE\": 55, \n    \"PEWTER_MART\": 56, \"PEWTER_SPEECH_HOUSE\": 57, \"PEWTER_POKECENTER\": 58,\n    \"MT_MOON_1F\": 59, \"MT_MOON_B1F\": 60, \"MT_MOON_B2F\": 61, \"TRASHED_HOUSE\": 62,\n    \"MELANIES_HOUSE\": 63, \"CERULEAN_POKECENTER\": 64, \"CERULEAN_GYM\": 65, \n    \"BIKE_SHOP\": 66, \"CERULEAN_MART\": 67, \"MT_MOON_POKECENTER\": 68,\n    \"CERULEAN_BADGE_HOUSE\": 230, \"ROUTE_5_GATE\": 70, \"UNDERGROUND_PATH_R5_R6_NORTH_ENTRANCE\": 71,\n    \"DAYCARE\": 72, \"ROUTE_6_GATE\": 73, \"UNDERGROUND_PATH_R5_R6_SOUTH_ENTRANCE\": 74,\n    \"ROUTE_7_GATE\": 76, \"UNDERGROUND_PATH_R7_R8_WEST_ENTRANCE\": 77, \"ROUTE_8_GATE\": 79,\n    \"UNDERGROUND_PATH_R7_R8_EAST_ENTRANCE\": 80, \"ROCK_TUNNEL_POKECENTER\": 81, \n    \"ROCK_TUNNEL_1F\": 82, \"POWER_PLANT\": 83, \"ROUTE_11_GATE_1F\": 84,\n    \"DIGLETTS_CAVE_R11_HOUSE\": 85, \"ROUTE_11_GATE_2F\": 86, \"ROUTE_12_GATE_1F\": 87,\n    \"BILLS_SEA_COTTAGE\": 88, \"VERMILION_POKECENTER\": 89, \"POKEMON_FAN_CLUB\": 90,\n    \"VERMILION_MART\": 91, \"VERMILION_GYM\": 92, \"PIDGEY_HOUSE\": 93, \"VERMILION_DOCK\": 94,\n    \"SS_ANNE_1F\": 95, \"SS_ANNE_2F\": 96, \"SS_ANNE_3F\": 97, \"SS_ANNE_B1F\": 98,\n    \"SS_ANNE_BOW\": 99, \"SS_ANNE_KITCHEN\": 100, \"SS_ANNE_CAPTAINS_ROOM\": 101,\n    \"SS_ANNE_1F_ROOMS\": 102, \"SS_ANNE_2F_ROOMS\": 103, \"SS_ANNE_B1F_ROOMS\": 104,\n    \"CELADON_DEPT_STORE_1F\": 122, \"CELADON_DEPT_STORE_2F\": 123, \"CELADON_DEPT_STORE_3F\": 124,\n    \"CELADON_DEPT_STORE_4F\": 125, \"CELADON_DEPT_STORE_ROOF\": 126, \"CELADON_DEPT_STORE_ELEVATOR\": 127,\n    \"CELADON_MANSION_1F\": 128, \"CELADON_MANSION_2F\": 129, \"CELADON_MANSION_3F\": 130,\n    \"CELADON_MANSION_ROOF\": 131, \"CELADON_MANSION_ROOF_HOUSE\": 132, \"CELADON_POKECENTER\": 133,\n    \"CELADON_GYM\": 134, \"GAME_CORNER\": 135, \"CELADON_DEPT_STORE_5F\": 136, \n    \"GAME_CORNER_PRIZE_ROOM\": 137, \"CELADON_DINER\": 138, \"CELADON_CHIEF_HOUSE\": 139, \n    \"CELADON_HOTEL\": 140, \"LAVENDER_POKECENTER\": 141, \"POKEMON_TOWER_1F\": 142, \n    \"POKEMON_TOWER_2F\": 143, \"POKEMON_TOWER_3F\": 144, \"POKEMON_TOWER_4F\": 145, \n    \"POKEMON_TOWER_5F\": 146, \"POKEMON_TOWER_6F\": 147, \"POKEMON_TOWER_7F\": 148, \n    \"MR_FUJIS_HOUSE\": 149, \"LAVENDER_MART\": 150, \"ROUTE_16_GATE_1F\": 186,\n    \"ROUTE_16_GATE_2F\": 187, \"ROUTE_16_FLY_HOUSE\": 188, \"SUPER_ROD_HOUSE\": 189,\n    \"ROUTE_18_GATE_1F\": 190, \"ROUTE_18_GATE_2F\": 191, \"VERMILION_TRADE_HOUSE\": 196, \"DIGLETTS_CAVE\": 197, \"ROCKET_HIDEOUT_B1F\": 199,\n    \"ROCKET_HIDEOUT_B2F\": 200, \"ROCKET_HIDEOUT_B3F\": 201, \"ROCKET_HIDEOUT_B4F\": 202,\n    \"ROCKET_HIDEOUT_ELEVATOR\": 203, \"SILPH_CO_1F\": 181, \"SAFFRON_POKECENTER\": 182,\n    \"MR_PSYCHICS_HOUSE\": 183, \"SAFFRON_MART\": 180, \"SILPH_CO_2F\": 207, \n    \"SILPH_CO_3F\": 208, \"SILPH_CO_4F\": 209, \"SILPH_CO_5F\": 210, \"SILPH_CO_6F\": 211,\n    \"SILPH_CO_7F\": 212, \"SILPH_CO_8F\": 213, \"SILPH_CO_9F\": 233, \"SILPH_CO_10F\": 234,\n    \"SILPH_CO_11F\": 235, \"SILPH_CO_ELEVATOR\": 236, \"BATTLE_TENT\": 231, \n    \"ROCK_TUNNEL_B1F\": 232, \"NAME_RATERS_HOUSE\": 229, \"ROUTE_15_GATE_1F\": 184, \"ROUTE_15_GATE_2F\": 195\n}\n\ndef get_map_id(map_name_or_id):\n    if isinstance(map_name_or_id, int):\n        return map_name_or_id\n    if isinstance(map_name_or_id, str) and map_name_or_id.isdigit():\n        return int(map_name_or_id)\n    return MAP_NAME_TO_ID.get(str(map_name_or_id).upper())\n\nwkg = json.loads(world_knowledge_graph_json_string)\nnodes = wkg.get('nodes', [])\n\ndef find_node(map_id, x, y):\n    for node in nodes:\n        if str(get_map_id(node.get('map_id'))) == str(map_id) and node['coordinates']['x'] == x and node['coordinates']['y'] == y:\n            return node['id']\n    return None\n\nsource_map_id = get_map_id(input_data['source_map_name'])\ndest_map_id = get_map_id(input_data['destination_map_name'])\n\nsource_node_id = find_node(source_map_id, int(input_data['source_x']), int(input_data['source_y']))\ndest_node_id = find_node(dest_map_id, int(input_data['destination_x']), int(input_data['destination_y']))\n\nif not source_node_id:\n    # This part would call manage_world_knowledge to add a node, but we can't do that from a tool.\n    # We'll just print what we would do.\n    print(f\"ACTION: manage_world_knowledge('add_node', payload='{{\\\"map_id\\\": \\\"{input_data['source_map_name']}\\\", \\\"name\\\": \\\"{input_data['source_node_name']}\\\", \\\"coordinates\\\": {{\\\"x\\\": {input_data['source_x']}, \\\"y\\\": {input_data['source_y']}}}}}')\")\n\nif not dest_node_id:\n    print(f\"ACTION: manage_world_knowledge('add_node', payload='{{\\\"map_id\\\": \\\"{input_data['destination_map_name']}\\\", \\\"name\\\": \\\"{input_data['destination_node_name']}\\\", \\\"coordinates\\\": {{\\\"x\\\": {input_data['destination_x']}, \\\"y\\\": {input_data['destination_y']}}}}}')\")\n\nif source_node_id and dest_node_id:\n    print(f\"ACTION: manage_world_knowledge('add_edge', payload='{{\\\"source_node_id\\\": \\\"{source_node_id}\\\", \\\"destination_node_id\\\": \\\"{dest_node_id}\\\", \\\"connection_type\\\": \\\"{input_data['connection_type']}\\\", \\\"is_one_way\\\": {str(input_data['is_one_way']).lower()}}}')\")\nelse:\n    print(\"Could not create edge because one or both nodes are missing and need to be created first.\")\n"
  }
}