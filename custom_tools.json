{
  "find_path_v4": {
    "description": "Finds the shortest path to a target coordinate. Correctly handles walls, NPCs, items, and unseen tiles. If the target is impassable, finds a path to an adjacent tile.",
    "input_schema": {
      "properties": {
        "target_x": {
          "type": "integer"
        },
        "target_y": {
          "type": "integer"
        }
      },
      "required": [
        "target_x",
        "target_y"
      ],
      "type": "object"
    },
    "python_script": "import json\nimport xml.etree.ElementTree as ET\nfrom collections import deque\n\ndef main(input_data):\n    target_x = int(input_data['target_x'])\n    target_y = int(input_data['target_y'])\n    root = ET.fromstring(map_xml_string)\n    traversable_types = {\"FLOOR\", \"STAIRCASE\", \"WARP_CARPET\", \"WARP_CARPET_DOWN\", \"WARP_CARPET_UP\", \"WARP_CARPET_LEFT\", \"WARP_CARPET_RIGHT\", \"LADDER\", \"GRASS\", \"CAVE\", \"SAND\", \"SNOW\", \"TALL_GRASS\", \"unseen\"}\n    grid = {}\n    player_pos = None\n    for row in root.findall('Row'):\n        y = int(row.get('id'))\n        for tile in row.findall('Tile'):\n            x = int(tile.get('id'))\n            t_type = tile.get('type')\n            if tile.find('Player') is not None:\n                player_pos = (x, y)\n            is_passable = t_type in traversable_types and tile.find('Object') is None\n            grid[(x, y)] = {\"passable\": is_passable, \"type\": t_type}\n    if player_pos is None:\n        print(json.dumps([]))\n        return\n    queue = deque([(player_pos, [])])\n    visited = {player_pos}\n    while queue:\n        (curr_x, curr_y), path = queue.popleft()\n        if curr_x == target_x and curr_y == target_y:\n            print(json.dumps(path))\n            return\n        if abs(curr_x - target_x) + abs(curr_y - target_y) == 1:\n            if not grid.get((target_x, target_y), {}).get(\"passable\"):\n                print(json.dumps(path))\n                return\n        for dx, dy, move in [(0, -1, \"Up\"), (0, 1, \"Down\"), (-1, 0, \"Left\"), (1, 0, \"Right\")]:\n            nx, ny = curr_x + dx, curr_y + dy\n            if (nx, ny) in grid and grid[(nx, ny)][\"passable\"] and (nx, ny) not in visited:\n                visited.add((nx, ny))\n                queue.append(((nx, ny), path + [move]))\n    print(json.dumps([]))\n\nif __name__ == \"__main__\":\n    main(input_data)\n",
    "history": [
      {
        "commit_message": "Initial version",
        "timestamp": "2025-12-21T06:11:17.104Z",
        "action_counter": 8161
      },
      {
        "commit_message": "Fixed find_path_v4: removed non-standard getparent() call and improved player position detection. Consolidated grid construction and BFS.",
        "timestamp": "2025-12-21T06:23:10.110Z",
        "action_counter": 8180
      },
      {
        "commit_message": "Ensure tool correctly returns a list of button strings for overworld navigation when autopress_buttons is true. Fixes previous formatting issues.",
        "timestamp": "2025-12-22T02:53:22.052Z",
        "action_counter": 10751
      },
      {
        "commit_message": "Fix player position detection in find_path_v4 to avoid TypeError when start_row is not found via XPath. Use a more robust loop-based approach.",
        "timestamp": "2025-12-22T02:54:08.460Z",
        "action_counter": 10753
      },
      {
        "commit_message": "Improved traversable types to include 'unseen' for optimistic pathfinding and added logic to path to adjacent tiles if the target is impassable (e.g., an NPC or wall).",
        "timestamp": "2025-12-22T05:52:22.947Z",
        "action_counter": 11104
      }
    ]
  },
  "battle_move_selector_v2": {
    "description": "Selects a move from the move selection menu in battle. Assumes the move selection menu is open. Calculates the shortest path between current_index and target_index in a wrapping menu of 4 moves. Includes an initial 1000ms safety delay.",
    "input_schema": {
      "properties": {
        "current_index": {
          "description": "The current 0-indexed position of the cursor in the move menu.",
          "type": "integer"
        },
        "target_index": {
          "description": "The 0-indexed position of the move to select (0-3).",
          "type": "integer"
        }
      },
      "required": [
        "current_index",
        "target_index"
      ],
      "type": "object"
    },
    "python_script": "import json\n\ndef main(input_data):\n    # Standard battle move menu in Pokemon Crystal is a 1x4 vertical list.\n    # Navigation: Up/Down only. The menu wraps.\n    try:\n        current = int(input_data['current_index'])\n        target = int(input_data['target_index'])\n    except (KeyError, ValueError, TypeError):\n        print(json.dumps([]))\n        return\n\n    if current == target:\n        print(json.dumps([\"A\"]))\n        return\n\n    # Calculate distances for wrapping 4-item menu\n    # dist_down: moves from current to target moving forward (0->1->2->3->0)\n    # dist_up: moves from current to target moving backward (0->3->2->1->0)\n    dist_down = (target - current) % 4\n    dist_up = (current - target) % 4\n    \n    buttons = [\"sleep 1000\"]\n    if dist_down <= dist_up:\n        buttons.extend([\"Down\"] * dist_down)\n    else:\n        buttons.extend([\"Up\"] * dist_up)\n        \n    buttons.append(\"A\")\n    print(json.dumps(buttons))\n\nif __name__ == \"__main__\":\n    main(input_data)\n",
    "history": [
      {
        "commit_message": "Initial version",
        "timestamp": "2025-12-21T11:41:54.981Z",
        "action_counter": 8762
      },
      {
        "commit_message": "Corrected tool to use the 'input_data' variable for arguments instead of reading from stdin.",
        "timestamp": "2025-12-21T11:46:11.447Z",
        "action_counter": 8774
      },
      {
        "commit_message": "Added a safety delay (sleep 500) to ensure the move selection menu is fully active before button presses.",
        "timestamp": "2025-12-21T14:19:46.168Z",
        "action_counter": 9031
      },
      {
        "commit_message": "Fixed the tool by adding the necessary 'run(input_data)' call at the end of the script and added a cursor reset (3 Ups) to ensure it starts from move 0.",
        "timestamp": "2025-12-21T14:21:30.713Z",
        "action_counter": 9035
      },
      {
        "commit_message": "Increased initial safety delay to 1000ms to handle menu opening animations and added a 300ms delay after each move selection button to prevent input dropping.",
        "timestamp": "2025-12-21T14:22:49.888Z",
        "action_counter": 9037
      },
      {
        "commit_message": "Removed the faulty 'Up' reset logic which caused misclicks due to menu wrapping. Now relies on Gen 2's default behavior of resetting the cursor to 0 on menu open.",
        "timestamp": "2025-12-21T14:28:43.731Z",
        "action_counter": 9045
      },
      {
        "commit_message": "Re-added cursor reset (Up, Up, Up) with safety delays. In Gen 2, the move selection menu does NOT wrap, making this a reliable way to ensure the tool starts from move 0 even if the menu was already open.",
        "timestamp": "2025-12-21T14:31:21.406Z",
        "action_counter": 9048
      },
      {
        "commit_message": "Removed the faulty 'Up' reset logic and added a clear explanation in the description that the tool assumes the cursor starts at move index 0. This is necessary because the Gen 2 move menu wraps, making 'Up' resets unreliable.",
        "timestamp": "2025-12-21T14:32:49.857Z",
        "action_counter": 9049
      },
      {
        "commit_message": "Refined battle_move_selector_v2 to handle Gen 2's menu wrapping and memory. It now takes both current_index and target_index to calculate the most efficient path (Up or Down). Added safety delays.",
        "timestamp": "2025-12-21T14:44:07.047Z",
        "action_counter": 9061
      },
      {
        "commit_message": "Initial definition of battle move selector.",
        "timestamp": "2025-12-21T16:45:38.503Z",
        "action_counter": 9332
      },
      {
        "commit_message": "Fixed move selection logic to handle a 1x4 vertical wrapping menu using only Up/Down buttons, as per Pokémon Crystal mechanics. Prevents incorrect horizontal navigation attempts in battle.",
        "timestamp": "2025-12-22T06:11:52.157Z",
        "action_counter": 11145
      }
    ]
  },
  "swap_pokemon_v1": {
    "description": "Swaps the positions of two Pokemon in the party. Can be called from the overworld or the main menu. Includes safety delays and cursor resets for reliable navigation.",
    "input_schema": {
      "type": "object",
      "properties": {
        "pos1": {
          "type": "integer",
          "description": "The 0-indexed position of the first Pokemon (0-5)."
        },
        "pos2": {
          "type": "integer",
          "description": "The 0-indexed position of the second Pokemon (0-5)."
        },
        "menu_already_open": {
          "type": "boolean",
          "description": "Whether the main menu is already open."
        }
      },
      "required": [
        "pos1",
        "pos2",
        "menu_already_open"
      ]
    },
    "python_script": "import json\n\ndef main():\n    pos1 = int(input_data['pos1'])\n    pos2 = int(input_data['pos2'])\n    menu_already_open = input_data['menu_already_open']\n    \n    buttons = []\n    \n    if not menu_already_open:\n        buttons.append(\"Start\")\n        buttons.append(\"sleep 1000\")\n    \n    # Enter POKEMON menu\n    # Assume cursor is on POKEMON (index 1)\n    buttons.append(\"A\")\n    buttons.append(\"sleep 1500\")\n    \n    # Party cursor starts at pos 0 upon entry.\n    for _ in range(pos1):\n        buttons.append(\"Down\")\n        buttons.append(\"sleep 300\")\n    \n    buttons.append(\"A\") # Select pos1\n    buttons.append(\"sleep 1000\")\n    \n    # Select SWITCH\n    # Robust logic: Up x4 from any menu start always hits SWITCH.\n    for _ in range(4):\n        buttons.append(\"Up\")\n        buttons.append(\"sleep 200\")\n    \n    buttons.append(\"A\") # Confirm SWITCH\n    buttons.append(\"sleep 1000\")\n    \n    # Move to pos2 relative to pos1\n    diff = pos2 - pos1\n    if diff > 0:\n        for _ in range(diff):\n            buttons.append(\"Down\")\n            buttons.append(\"sleep 300\")\n    elif diff < 0:\n        for _ in range(-diff):\n            buttons.append(\"Up\")\n            buttons.append(\"sleep 300\")\n            \n    buttons.append(\"A\") # Confirm swap\n    buttons.append(\"sleep 1500\")\n    \n    # Exit menus\n    buttons.append(\"B\")\n    buttons.append(\"sleep 600\")\n    buttons.append(\"B\")\n    buttons.append(\"sleep 600\")\n    buttons.append(\"B\")\n    \n    print(json.dumps(buttons))\n\nif __name__ == \"__main__\":\n    main()",
    "history": [
      {
        "commit_message": "Initial version",
        "timestamp": "2025-12-22T08:39:05.748Z",
        "action_counter": 11491
      },
      {
        "commit_message": "Fixing input handling: using global input_data instead of sys.argv[1]. Added safety delays and clearer menu navigation logic.",
        "timestamp": "2025-12-22T08:40:17.227Z",
        "action_counter": 11493
      },
      {
        "commit_message": "Refining swap_pokemon_v1 to handle persistent menu cursor positions and sub-menu navigation more robustly. Added cursor resets (multiple Up presses).",
        "timestamp": "2025-12-22T09:41:07.253Z",
        "action_counter": 11587
      },
      {
        "commit_message": "Adding comprehensive cursor resets to all menu levels (main menu, party menu, and sub-menus) to ensure reliable navigation regardless of persistent cursor positions.",
        "timestamp": "2025-12-22T09:43:10.333Z",
        "action_counter": 11588
      },
      {
        "commit_message": "Fixing tool definition by providing required commit message.",
        "timestamp": "2025-12-22T12:33:22.615Z",
        "action_counter": 11951
      }
    ]
  },
  "grass_dance_tool": {
    "description": "Returns a list of button presses to pace back and forth in tall grass to trigger a wild encounter.",
    "input_schema": {
      "type": "object",
      "properties": {
        "steps": {
          "type": "integer"
        }
      },
      "required": [
        "steps"
      ]
    },
    "python_script": "import json\ndef grass_dance(steps):\n    buttons = []\n    for i in range(steps // 2):\n        buttons.extend([\"Left\", \"Right\"])\n    if steps % 2 != 0:\n        buttons.append(\"Left\")\n    return buttons\n\nsteps = int(input_data['steps'])\nprint(json.dumps(grass_dance(steps)))",
    "history": [
      {
        "commit_message": "Initial version",
        "timestamp": "2025-12-22T14:41:14.078Z",
        "action_counter": 12241
      }
    ]
  },
  "check_suicune_location_v2": {
    "description": "Automates checking Suicune's location on the Pokédex AREA map. Handles menu navigation from any starting cursor index.",
    "input_schema": {
      "type": "object",
      "properties": {
        "current_menu_index": {
          "type": "integer",
          "description": "The current 0-indexed position of the menu cursor (0-7)."
        },
        "menu_already_open": {
          "type": "boolean",
          "description": "Whether the main menu is already open."
        }
      },
      "required": [
        "current_menu_index",
        "menu_already_open"
      ]
    },
    "python_script": "import json\nimport sys\n\ndef main():\n    try:\n        input_data = json.loads(sys.argv[1])\n        current_index = int(input_data.get('current_menu_index', 0))\n        # Handle boolean or string 'true'/'false'\n        menu_open_raw = input_data.get('menu_already_open', False)\n        if isinstance(menu_open_raw, str):\n            menu_open = menu_open_raw.lower() == 'true'\n        else:\n            menu_open = bool(menu_open_raw)\n    except (IndexError, ValueError, json.JSONDecodeError):\n        current_index = 0\n        menu_open = False\n    \n    buttons = []\n    if not menu_open:\n        buttons.append(\"Start\")\n        buttons.append(\"sleep 1000\")\n    \n    # Target POKEDEX is index 0\n    # Menu: 0:POKEDEX, 1:PKMN, 2:PACK, 3:GEAR, 4:NAME, 5:SAVE, 6:OPTION, 7:EXIT\n    up_dist = (current_index - 0) % 8\n    down_dist = (0 - current_index) % 8\n    \n    if up_dist <= down_dist:\n        for _ in range(up_dist):\n            buttons.append(\"Up\")\n            buttons.append(\"sleep 600\")\n    else:\n        for _ in range(down_dist):\n            buttons.append(\"Down\")\n            buttons.append(\"sleep 600\")\n            \n    # Enter Pokedex\n    buttons.append(\"A\")\n    buttons.append(\"sleep 2000\")\n    # Enter Suicune entry (assumed selected or at top)\n    buttons.append(\"A\")\n    buttons.append(\"sleep 2500\")\n    # Move to AREA\n    buttons.append(\"Right\")\n    buttons.append(\"sleep 800\")\n    buttons.append(\"A\")\n    buttons.append(\"sleep 6000\")\n    # Exit all menus\n    for _ in range(5):\n        buttons.append(\"B\")\n        buttons.append(\"sleep 1000\")\n        \n    print(json.dumps(buttons))\n\nif __name__ == \"__main__\":\n    main()",
    "history": [
      {
        "commit_message": "Refined to take starting menu index to ensure POKEDEX is selected correctly.",
        "timestamp": "2025-12-22T21:25:40.266Z",
        "action_counter": 12842
      },
      {
        "commit_message": "Refined input handling and added initial safety delay.",
        "timestamp": "2025-12-22T21:26:23.470Z",
        "action_counter": 12844
      },
      {
        "commit_message": "Refined JSON parsing and logic to ensure menu navigation is reliable.",
        "timestamp": "2025-12-22T21:27:44.290Z",
        "action_counter": 12845
      },
      {
        "commit_message": "Added menu_already_open parameter and Start button logic. Fixed JSON parsing.",
        "timestamp": "2025-12-22T21:29:02.845Z",
        "action_counter": 12846
      },
      {
        "commit_message": "Refined JSON parsing and added navigation delays to ensure menu reliability.",
        "timestamp": "2025-12-22T21:30:10.535Z",
        "action_counter": 12847
      },
      {
        "commit_message": "Refined menu wrapping logic and increased safety delays for Pokédex navigation.",
        "timestamp": "2025-12-22T21:43:21.319Z",
        "action_counter": 12872
      },
      {
        "commit_message": "Improved argument handling and added explicit cursor verification for menu navigation.",
        "timestamp": "2025-12-22T21:45:44.721Z",
        "action_counter": 12877
      }
    ]
  }
}